import{r as n,o as A,c as j,j as o,a as N,e as R}from"./index-B2O2Sb9f.js";import{h as H,s as L,a}from"./Tasks.module-DJ8hkE_C.js";const M=({t:T,currentBalance:d,userId:b,lang:l,userRole:x})=>{const[I,k]=n.useState([]),[m,i]=n.useState(null),[E,c]=n.useState(null),[$,y]=n.useState(!1),u=n.useRef(null),p=n.useRef(new Audio(H)).current,w=n.useRef(new Audio(L)).current;n.useEffect(()=>{const e=A(j(N,"achievements_list"),r=>{const t=r.docs.map(s=>({id:s.id,...s.data()})).filter(s=>s.type==="reward"||s.type==="exchange").sort((s,f)=>s.threshold-f.threshold);k(t),y(!0)},r=>{console.error("SHOP Error:",r),y(!0)});return()=>e()},[b]);const h=e=>e.label||e.labelRu||(e.labels?e.labels[l]||e.labels.ru:"‚Äî"),S=async e=>{const r=h(e);try{w.currentTime=0,w.play().catch(()=>{}),await R(j(N,"approvals"),{userId:b,label:`${T.admin.typeReward}: ${r}`,points:-Number(e.threshold),icon:e.icon,status:"pending",createdAt:new Date().toISOString()}),alert(l==="fi"?"Tilaus l√§hetetty!":"–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")}catch(t){console.error("–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:",t)}},v=e=>{if(m)return;if(x==="parent"){const s=l==="fi"?`Osta "${h(e)}"?`:`–ö—É–ø–∏—Ç—å "${h(e)}"?`;window.confirm(s)&&S(e);return}const r=Number(e.threshold);if(Number(d)<r){c(e.id),setTimeout(()=>c(null),500);return}i(e.id),p.currentTime=0,p.play().catch(()=>{}),u.current=window.setTimeout(async()=>{if(Number(d)<Number(e.threshold)){i(null),c(e.id),setTimeout(()=>c(null),500);return}p.pause(),await S(e),i(null)},5e3)},g=()=>{u.current&&(window.clearTimeout(u.current),u.current=null),i(null),p.pause()};return $?o.jsxs("div",{style:{padding:"10px"},children:[o.jsxs("h3",{className:a.statsInfo,children:[o.jsx("span",{style:{color:"var(--accent-green)"},children:l==="fi"?"Kauppa":"–ú–∞–≥–∞–∑–∏–Ω"}),o.jsxs("span",{style:{color:"var(--text-main)"},children:[" üí∞ ",d]})]}),o.jsx("div",{className:a.tasksGrid,style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"10px"},children:I.map(e=>{const r=h(e),t=m===e.id,s=E===e.id,f=d>=e.threshold;return o.jsxs("div",{onMouseDown:()=>v(e),onMouseUp:g,onMouseLeave:g,onTouchStart:()=>v(e),onTouchEnd:g,className:`
                ${a.shopCard} 
                ${f||x==="parent"?a.shopCardAffordable:a.shopCardLocked}
                ${t?a.shakingIntense:""} 
                ${s?a.insufficientFunds:""}
              `,style:{background:"rgba(255,255,255,0.05)",border:s?"2px solid red":t?"2px solid var(--accent-green)":"1px solid #444",padding:"15px",borderRadius:"20px",display:"flex",flexDirection:"column",alignItems:"center",minHeight:"140px",position:"relative",overflow:"hidden",touchAction:"none",userSelect:"none",cursor:"pointer"},children:[t&&o.jsx("div",{style:{position:"absolute",bottom:0,left:0,height:"5px",background:"var(--accent-green)",width:"100%",animation:"holdProgress 5s linear forwards"}}),o.jsx("div",{style:{fontSize:"40px"},children:e.icon}),o.jsx("div",{style:{fontWeight:"bold",textAlign:"center",color:"white"},children:r}),o.jsxs("div",{style:{background:f||x==="parent"?"var(--accent-green)":"#666",color:"white",padding:"2px 10px",borderRadius:"10px",marginTop:"auto",fontSize:"14px"},children:[e.threshold," pts"]})]},e.id)})})]}):o.jsx("div",{style:{color:"white",padding:"20px"},children:"Loading..."})};export{M as Shop};
