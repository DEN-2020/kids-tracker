import{r as o,o as m,c as A,d as j,j as s,a as g,u as $,b as k}from"./index-COUtcPaj.js";import{h as H,s as I,a as c}from"./Tasks.module-B6vfeooQ.js";const M=({t:u,totalPoints:i,userId:l})=>{const[S,w]=o.useState([]),[y,R]=o.useState([]),[T,p]=o.useState(null),h=o.useRef(null),r=o.useRef(new Audio(H)).current,v=o.useRef(new Audio(I)).current;o.useEffect(()=>{if(!l||l.trim()==="")return;const e=m(A(g,"achievements_list"),a=>{const f=a.docs.map(d=>({id:d.id,...d.data()})).filter(d=>d.type==="title").sort((d,z)=>d.threshold-z.threshold);w(f)}),n=j(g,"users",l),t=m(n,a=>{a.exists()&&R(a.data().activatedAchievements||[])});return()=>{e(),t()}},[l]);const b=e=>{i<e.threshold||y.includes(e.id)||(p(e.id),r.currentTime=0,r.loop=!0,r.play().catch(()=>{}),h.current=window.setTimeout(async()=>{r.pause(),v.currentTime=0,v.play().catch(()=>{});const n=j(g,"users",l);await $(n,{activatedAchievements:k(e.id)}),p(null)},5e3))},x=()=>{h.current&&window.clearTimeout(h.current),p(null),r.pause(),r.loop=!1};return s.jsxs("div",{style:{padding:"10px"},children:[s.jsxs("h3",{style:{color:"var(--accent-orange)",marginBottom:"20px",display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{children:u.achievements.title}),s.jsxs("span",{style:{fontSize:"14px"},children:[i," XP"]})]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:S.map(e=>{const n=i>=e.threshold,t=y.includes(e.id),a=T===e.id,f=Math.min(i/e.threshold*100,100);return s.jsxs("div",{onMouseDown:()=>b(e),onMouseUp:x,onMouseLeave:x,onTouchStart:()=>b(e),onTouchEnd:x,className:`
                ${c.glassCard} 
                ${n?c.glassCardUnlocked:""} 
                ${a?c.shaking:""}
                ${a?c.glassCardHolding:""}
              `,style:{cursor:n&&!t?"pointer":"default",opacity:n?1:.8},children:[!n&&s.jsx("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:`${f}%`,background:"linear-gradient(90deg, rgba(255,152,0,0) 0%, rgba(255,152,0,0.1) 100%)",zIndex:0,transition:"width 0.5s ease"}}),a&&s.jsx("div",{className:c.neonProgressBar}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",position:"relative",zIndex:1},children:[s.jsx("div",{style:{fontSize:"40px",filter:n?"drop-shadow(0 0 10px rgba(255,255,255,0.3))":"grayscale(1) opacity(0.4)",transition:"all 0.5s ease"},children:e.icon}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{style:{fontWeight:"bold",fontSize:"18px",color:n?"#fff":"rgba(255,255,255,0.4)",textShadow:n?"0 0 10px rgba(255,255,255,0.2)":"none"},children:e.label||e.id}),e.bonus&&s.jsxs("div",{style:{marginTop:"5px",padding:"6px 12px",borderRadius:"12px",background:t?"rgba(76, 175, 80, 0.15)":"rgba(255,255,255,0.05)",fontSize:"13px",color:t?"#4ade80":"rgba(255,255,255,0.3)",border:t?"1px solid rgba(74, 222, 128, 0.2)":"1px solid transparent"},children:["üéÅ ",t?e.bonus:n?u.adminForm.saveBtn==="Tallenna"?"Pid√§ 5s":"–£–¥–µ—Ä–∂–∏–≤–∞–π 5 —Å–µ–∫":`${u.achievements.needed} ${e.threshold-i} XP`]})]}),s.jsx("div",{style:{fontSize:"24px",filter:n?"none":"opacity(0.2)"},children:t?"üåü":n?"üîì":"üîí"})]})]},e.id)})}),s.jsx("style",{children:`
        @keyframes fill5sec {
          from { transform: scaleX(0); }
          to { transform: scaleX(1); }
        }
      `})]})};export{M as Achievements};
