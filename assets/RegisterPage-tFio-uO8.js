import{r,j as a,s as S,d as P,a as E}from"./index-COUtcPaj.js";import{s as e}from"./Auth.module-BTKz4srt.js";const L=({googleUid:i,initialName:n,initialAvatar:d,onSuccess:y,t:s,lang:C})=>{const[l,m]=r.useState(n||""),[o,u]=r.useState("child"),[h,f]=r.useState(d||"üë∂"),[p,x]=r.useState(!1),[v,N]=r.useState("");r.useEffect(()=>{n&&!l&&m(n)},[n,l]);const b=async t=>{t&&t.preventDefault();const j=l.trim();if(!j){alert(s.auth.namePlaceholder);return}x(!0);try{const c=v.trim()||`fam_${i.slice(0,5)}_${Math.random().toString(36).substr(2,5)}`,g={uid:i,name:j,role:o,avatar:h,familyId:c,totalPoints:0,currentBalance:0};await S(P(E,"users",i),g),y(g)}catch(c){console.error("Registration error:",c),alert("Error saving profile")}finally{x(!1)}};return a.jsxs("form",{onSubmit:b,className:e.authPage,style:{minHeight:"auto"},children:[a.jsx("h2",{className:e.mainTitle,style:{fontSize:"24px"},children:s.auth.finishRegistration}),a.jsxs("div",{className:e.inputGroup,children:[a.jsx("div",{className:e.avatarBig,children:h}),a.jsx("input",{id:"reg-name",name:"username",className:e.glassInput,value:l,onChange:t=>m(t.target.value),placeholder:s.auth.namePlaceholder,required:!0,autoComplete:"name",style:{textAlign:"center"}})]}),a.jsxs("div",{className:e.roleSelection,children:[a.jsxs("div",{className:`${e.roleCard} ${o==="child"?e.roleCardActive:""}`,onClick:()=>{u("child"),f(d||"üë∂")},children:[a.jsx("div",{className:e.roleEmoji,children:"üë∂"}),a.jsx("div",{className:e.roleLabel,children:s.auth.roleChild})]}),a.jsxs("div",{className:`${e.roleCard} ${o==="parent"?e.roleCardActive:""}`,onClick:()=>{u("parent"),f("üßî")},children:[a.jsx("div",{className:e.roleEmoji,children:"üßî"}),a.jsx("div",{className:e.roleLabel,children:s.auth.roleParent})]})]}),a.jsxs("div",{className:e.inputGroup,children:[a.jsx("label",{htmlFor:"family-code",className:e.label,children:s.auth.familyCodeLabel}),a.jsx("input",{id:"family-code",name:"familyCode",className:e.glassInput,value:v,onChange:t=>N(t.target.value),placeholder:s.auth.familyCodePlaceholder,autoComplete:"off"}),a.jsx("p",{className:e.hint,children:s.auth.familyCodeHint})]}),a.jsx("button",{type:"submit",disabled:p||!l.trim(),className:e.submitBtn,style:{width:"100%",background:"var(--accent-green)",fontSize:"18px"},children:p?C==="ru"?"–ó–∞–≥—Ä—É–∑–∫–∞...":"Loading...":s.auth.startAdventure})]})};export{L as RegisterPage};
