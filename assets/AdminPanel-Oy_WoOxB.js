import{j as e,D as F,d as N,a as x,r,o as D,c as T,s as V,u as $,E as G,e as Q}from"./index-COUtcPaj.js";const ee="_panelContainer_19ml5_5",te="_leftCol_19ml5_69",se="_card_19ml5_83",ne="_statsHeader_19ml5_101",ae="_progressBar_19ml5_115",le="_progressFill_19ml5_131",oe="_clearButton_19ml5_141",re="_requestItem_19ml5_169",ie="_formHeader_19ml5_195",ce="_formAvatar_19ml5_209",de="_targetChild_19ml5_213",pe="_mainForm_19ml5_225",ue="_inputRow_19ml5_237",me="_iconInput_19ml5_247",xe="_labelInput_19ml5_267",he="_numberInput_19ml5_287",be="_inputGroup_19ml5_287",ve="_gridRow_19ml5_323",ge="_inputHint_19ml5_349",fe="_buttonGroup_19ml5_381",ye="_actionButton_19ml5_391",je="_actionIcon_19ml5_417",_e="_actionLabel_19ml5_419",Ne="_submitBtn_19ml5_423",we="_templatesContainer_19ml5_449",Se="_templateItem_19ml5_467",Ie="_templateSelected_19ml5_489",Ce="_templateInfo_19ml5_499",Be="_templateIcon_19ml5_511",Ae="_templateLabel_19ml5_513",ke="_templateSub_19ml5_515",Te="_templateActions_19ml5_519",Re="_copyBtn_19ml5_531",Fe="_deleteBtn_19ml5_549",t={panelContainer:ee,leftCol:te,card:se,statsHeader:ne,progressBar:ae,progressFill:le,clearButton:oe,requestItem:re,formHeader:ie,formAvatar:ce,targetChild:de,mainForm:pe,inputRow:ue,iconInput:me,labelInput:xe,numberInput:he,inputGroup:be,gridRow:ve,inputHint:ge,buttonGroup:fe,actionButton:ye,actionIcon:je,actionLabel:_e,submitBtn:Ne,templatesContainer:we,templateItem:Se,templateSelected:Ie,templateInfo:Ce,templateIcon:Be,templateLabel:Ae,templateSub:ke,templateActions:Te,copyBtn:Re,deleteBtn:Fe},De=["üìù","üßπ","üê±","üìö","üèÉ","ü•¶","ü¶∑","üò¥","üéÆ","üí°","üé®","‚öΩ"],O=({active:l,icon:p,label:g,onClick:m,activeColor:h})=>e.jsxs("div",{onClick:m,className:t.actionButton,style:{border:l?`2px solid ${h}`:"2px solid var(--border-color)",backgroundColor:l?`${h}15`:"var(--card-bg)",cursor:"pointer"},children:[e.jsx("span",{className:t.actionIcon,children:p}),e.jsx("span",{className:t.actionLabel,style:{color:l?h:"var(--text-secondary)"},children:g})]}),Le=({t:l,currentChild:p,onSubmit:g,editingId:m,onCancel:h,formState:i,setters:u})=>e.jsxs("section",{className:t.card,children:[e.jsxs("div",{className:t.formHeader,children:[e.jsx("span",{className:t.formAvatar,children:p?.avatar||"üë§"}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0},children:m?l.adminForm.editTitle:l.adminForm.createTitle}),e.jsxs("span",{className:t.targetChild,children:[l.adminForm.forLabel,": ",p?.name?.toUpperCase()||"..."]})]})]}),e.jsxs("form",{onSubmit:g,className:t.mainForm,children:[e.jsx("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",marginBottom:"15px",padding:"10px",background:"rgba(0,0,0,0.05)",borderRadius:"12px"},children:De.map(a=>e.jsx("span",{onClick:()=>u.setNewIcon(a),style:{fontSize:"24px",cursor:"pointer",transform:i.newIcon===a?"scale(1.3)":"scale(1)",transition:"transform 0.2s",filter:i.newIcon===a?"none":"grayscale(0.5) opacity(0.7)"},children:a},a))}),e.jsxs("div",{className:t.inputRow,children:[e.jsx("input",{className:t.iconInput,value:i.newIcon,onChange:a=>u.setNewIcon(a.target.value),placeholder:"üìù"}),e.jsx("input",{className:t.labelInput,value:i.newLabel,onChange:a=>u.setNewLabel(a.target.value),placeholder:l.taskName})]}),e.jsxs("div",{className:t.gridRow,children:[e.jsxs("div",{className:t.inputGroup,children:[e.jsx("span",{className:t.inputHint,children:l.adminForm.pointsLabel}),e.jsx("input",{className:t.numberInput,type:"number",value:i.newPoints,onChange:a=>u.setNewPoints(Number(a.target.value))})]}),e.jsxs("div",{className:t.inputGroup,children:[e.jsx("span",{className:t.inputHint,children:l.adminForm.minutesLabel}),e.jsx("input",{className:t.numberInput,type:"number",value:i.newDuration,onChange:a=>u.setNewDuration(Number(a.target.value))})]})]}),e.jsxs("div",{className:t.buttonGroup,children:[e.jsx(O,{active:i.autoRepeat,icon:"üîÑ",label:"Daily",activeColor:"#FF9800",onClick:()=>u.setAutoRepeat(!i.autoRepeat)}),e.jsx(O,{active:i.autoApprove,icon:"‚ö°",label:"Auto",activeColor:"#2196F3",onClick:()=>u.setAutoApprove(!i.autoApprove)}),e.jsx(O,{active:i.autoPayout,icon:"üí∞",label:"Payout",activeColor:"#4CAF50",onClick:()=>u.setAutoPayout(!i.autoPayout)})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{type:"submit",className:t.submitBtn,style:{flex:2},children:m?l.adminForm.saveBtn:`Ôºã ${l.adminForm.createBtn}`}),m&&e.jsx("button",{type:"button",onClick:h,className:t.submitBtn,style:{flex:1,background:"var(--text-secondary)",fontSize:"12px"},children:l.adminForm.copyAsNewBtn})]})]})]}),Pe=({t:l,tasks:p,users:g,selectedChildId:m,copyToForm:h})=>{const i=p.reduce((a,b)=>{const y=b.assignedTo||"all";return a[y]||(a[y]=[]),a[y].push(b),a},{}),u=Object.keys(i).sort((a,b)=>a==="all"?-1:b==="all"?1:a===m?-1:b===m?1:0);return e.jsx("div",{className:t.templatesContainer,children:u.map(a=>{const b=i[a],y=g.find(c=>c.uid===a),w=a===m;return e.jsxs("div",{style:{marginBottom:"25px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px",padding:"0 5px"},children:[e.jsx("span",{style:{fontSize:"12px",fontWeight:"900",color:w?"var(--accent-blue)":"#888",textTransform:"uppercase"},children:a==="all"?`üåç ${l.admin.templates}`:`üë§ ${y?.name||"User"}`}),e.jsx("div",{style:{flex:1,height:"1px",background:w?"var(--accent-blue)":"#eee",opacity:.5}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:b.map(c=>e.jsxs("div",{className:`${t.templateItem} ${c.assignedTo===m?t.templateSelected:""}`,style:{opacity:c.assignedTo===m||a==="all"?1:.8,borderLeft:c.assignedTo===m?"4px solid var(--accent-blue)":"1px solid #eee"},children:[e.jsxs("div",{className:t.templateInfo,children:[e.jsx("span",{className:t.templateIcon,children:c.icon||"üìù"}),e.jsxs("div",{children:[e.jsx("div",{className:t.templateLabel,children:c.label}),e.jsxs("div",{className:t.templateSub,children:[c.points," pts ",c.isAutoRepeat&&" ‚Ä¢ üîÑ"]})]})]}),e.jsxs("div",{className:t.templateActions,children:[e.jsx("button",{onClick:()=>h(c),className:t.copyBtn,children:"üìã"}),e.jsx("button",{onClick:()=>window.confirm(l.familySettings.deleteConfirm)&&F(N(x,"tasks_list",c.id)),className:t.deleteBtn,children:"√ó"})]})]},c.id))})]},a)})})},ze=["üèÜ","üíé","‚≠ê","ü•á","ü•à","ü•â","üöÄ","üëë","üßô","ü¶∏","üëæ","üåü"],$e=({t:l})=>{const[p,g]=r.useState([]),[m,h]=r.useState(!0),[i,u]=r.useState(""),[a,b]=r.useState(""),[y,w]=r.useState(100),[c,R]=r.useState("üèÜ"),v=l.admin||{};r.useEffect(()=>D(T(x,"achievements_list"),B=>{const f=B.docs.map(j=>{const n=j.data();return{id:j.id,...n,label:n.label||n.labelRu||n.translationKey||""}}).filter(j=>j.type==="title");g(f.sort((j,n)=>j.threshold-n.threshold)),h(!1)}),[]);const k=async()=>{if(!i)return;const o=`title_${Date.now()}`;await V(N(x,"achievements_list",o),{threshold:y,icon:c,label:i,bonus:a,type:"title"}),u(""),b("")};return m?e.jsx("div",{className:t.spinner,children:"‚åõ"}):e.jsxs("div",{className:t.card,children:[e.jsx("h3",{style:{color:"var(--accent-orange)"},children:l.admin.levelsTitle}),e.jsxs("div",{className:t.mainForm,style:{background:"var(--bg-color)",padding:"15px",borderRadius:"20px",marginBottom:"20px"},children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"15px",background:"#fff",padding:"10px",borderRadius:"12px"},children:ze.map(o=>e.jsx("span",{onClick:()=>R(o),style:{fontSize:"24px",cursor:"pointer",padding:"5px",borderRadius:"8px",background:c===o?"#fff3e0":"transparent",border:c===o?"1px solid var(--accent-orange)":"1px solid transparent"},children:o},o))}),e.jsx("div",{className:t.inputRow,children:e.jsx("input",{className:t.labelInput,value:i,onChange:o=>u(o.target.value),placeholder:v.placeholderName||"–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è..."})}),e.jsx("div",{className:t.inputRow,style:{marginTop:"10px"},children:e.jsx("input",{className:t.labelInput,value:a,onChange:o=>b(o.target.value),placeholder:v.placeholderBonus||"üéÅ –ü—Ä–∏–∑ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ...",style:{borderColor:"var(--accent-green)"}})}),e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsxs("span",{style:{fontSize:"12px"},children:[l.achievements.needed," (XP)"]}),e.jsx("input",{type:"number",className:t.numberInput,value:y,onChange:o=>w(Number(o.target.value))})]}),e.jsxs("button",{onClick:k,className:t.submitBtn,style:{marginTop:"15px",background:"var(--accent-orange)"},children:["‚ûï ",v.btnAdd]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:p.map(o=>e.jsxs("div",{className:t.templateItem,style:{borderLeft:"4px solid var(--accent-orange)"},children:[e.jsxs("div",{className:t.templateInfo,children:[e.jsx("span",{style:{fontSize:"28px"},children:o.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:o.label}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--accent-orange)",fontWeight:"bold"},children:[o.threshold," XP"]}),o.bonus&&e.jsxs("div",{style:{fontSize:"11px",color:"var(--accent-green)"},children:["üéÅ ",o.bonus]})]})]}),e.jsx("button",{onClick:()=>window.confirm(l.familySettings.deleteConfirm)&&F(N(x,"achievements_list",o.id)),className:t.deleteBtn,children:"√ó"})]},o.id))})]})},He=["üéÅ","üç¶","üéÆ","üö≤","üé¨","üí∂","üçï","üß∏","üïô","üì±","‚öΩ","üç©"],We=({t:l})=>{const[p,g]=r.useState([]),[m,h]=r.useState(!0),[i,u]=r.useState(""),[a,b]=r.useState(""),[y,w]=r.useState(50),[c,R]=r.useState("üéÅ"),[v,k]=r.useState("reward"),[o,B]=r.useState(0),f=l.admin||{};r.useEffect(()=>{const n=D(T(x,"achievements_list"),L=>{const z=L.docs.map(_=>{const S=_.data();return{id:_.id,...S,label:S.label||S.labels?.ru||S.labelRu||""}}).filter(_=>_.type==="reward"||_.type==="exchange").sort((_,S)=>_.threshold-S.threshold);g(z),h(!1)});return()=>n()},[]);const j=async()=>{if(!i)return;const n=`${v}_${Date.now()}`;await V(N(x,"achievements_list",n),{threshold:y,icon:c,type:v,label:i,description:a,...v==="exchange"&&{valueInEuro:o}}),u(""),b(""),B(0)};return m?e.jsx("div",{className:t.spinner,children:"‚åõ"}):e.jsxs("div",{className:t.card,style:{borderTop:"4px solid var(--accent-green)"},children:[e.jsxs("h3",{style:{color:"var(--accent-green)"},children:["üõí ",f.shopSettingsTitle]}),e.jsxs("div",{className:t.mainForm,style:{background:"var(--bg-color)",padding:"15px",borderRadius:"20px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px"},children:[e.jsxs("button",{onClick:()=>k("reward"),className:t.actionButton,style:{flex:1,background:v==="reward"?"var(--accent-green)":"white",color:v==="reward"?"white":"black"},children:["üéÅ ",f.typeReward]}),e.jsxs("button",{onClick:()=>k("exchange"),className:t.actionButton,style:{flex:1,background:v==="exchange"?"var(--accent-blue)":"white",color:v==="exchange"?"white":"black"},children:["üí∂ ",f.typeMoney]})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"15px"},children:He.map(n=>e.jsx("span",{onClick:()=>R(n),style:{fontSize:"24px",cursor:"pointer",padding:"5px",borderRadius:"8px",background:c===n?"#e8f5e9":"transparent",border:c===n?"1px solid var(--accent-green)":"1px solid transparent"},children:n},n))}),e.jsx("input",{className:t.labelInput,value:i,onChange:n=>u(n.target.value),placeholder:f.placeholderName,style:{marginBottom:"10px"}}),e.jsx("input",{className:t.labelInput,value:a,onChange:n=>b(n.target.value),placeholder:f.placeholderDesc,style:{marginBottom:"10px",fontSize:"14px",borderColor:"#eee"}}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontSize:"11px"},children:f.labelPricePoints}),e.jsx("input",{type:"number",className:t.numberInput,value:y,onChange:n=>w(Number(n.target.value))})]}),v==="exchange"&&e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontSize:"11px"},children:f.labelAmountEuro}),e.jsx("input",{type:"number",className:t.numberInput,value:o,onChange:n=>B(Number(n.target.value))})]})]}),e.jsxs("button",{onClick:j,className:t.submitBtn,style:{marginTop:"15px",background:"var(--accent-green)"},children:["‚ûï ",f.btnAdd]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:p.map(n=>e.jsxs("div",{className:t.templateItem,style:{borderLeft:`4px solid ${n.type==="reward"?"var(--accent-green)":"var(--accent-blue)"}`},children:[e.jsxs("div",{className:t.templateInfo,children:[e.jsx("span",{style:{fontSize:"24px"},children:n.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px"},children:n.label}),n.description&&e.jsx("div",{style:{fontSize:"12px",color:"#888",fontStyle:"italic"},children:n.description}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:[n.threshold," pts ",n.valueInEuro?` ‚Üí ${n.valueInEuro}‚Ç¨`:""]})]})]}),e.jsx("button",{onClick:()=>window.confirm(l.familySettings.deleteConfirm)&&F(N(x,"achievements_list",n.id)),className:t.deleteBtn,children:"√ó"})]},n.id))})]})},Ge=({t:l,selectedChildId:p,mode:g,lang:m})=>{const[h,i]=r.useState([]),[u,a]=r.useState([]),[b,y]=r.useState([]),[w,c]=r.useState(""),[R,v]=r.useState(10),[k,o]=r.useState("üìù"),[B,f]=r.useState(0),[j,n]=r.useState(!1),[L,P]=r.useState(!1),[z,_]=r.useState(!1),[S,H]=r.useState(null);r.useEffect(()=>{const s=D(T(x,"tasks_list"),I=>{i(I.docs.map(C=>({id:C.id,...C.data()})))}),d=D(T(x,"approvals"),I=>{a(I.docs.map(C=>({id:C.id,...C.data()})))}),A=D(T(x,"users"),I=>{y(I.docs.map(C=>({uid:C.id,...C.data()})))});return()=>{s(),d(),A()}},[]);const q=b.find(s=>s.uid===p),U=new Date().toISOString().split("T")[0],K=h.filter(s=>s.assignedTo===p||s.assignedTo==="all"),W=K.reduce((s,d)=>s+d.points,0),M=K.filter(s=>s.lastCompleted===U).reduce((s,d)=>s+d.points,0),E=W>0?Math.round(M/W*100):0,X=s=>{c(s.label),v(s.points),o(s.icon||"üìù"),f(s.duration||0),n(!!s.isAutoRepeat),P(!!s.isAutoApprove),_(!!s.isAutoPayout),H(s.id),window.scrollTo({top:0,behavior:"smooth"})},J=async s=>{if(s.userId){a(d=>d.filter(A=>A.id!==s.id));try{const d=N(x,"users",s.userId),A=s.points<0;if(A?await $(d,{currentBalance:G(s.points)}):await $(d,{totalPoints:G(s.points),currentBalance:G(s.points)}),await Q(T(x,"history"),{userId:s.userId,label:s.label,points:s.points,date:new Date,type:A?"spend":"earn"}),s.taskId){const I=h.find(C=>C.id===s.taskId);I&&(I.isAutoRepeat?await $(N(x,"tasks_list",I.id),{lastCompleted:U}):await F(N(x,"tasks_list",I.id)))}await F(N(x,"approvals",s.id))}catch(d){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏:",d)}}},Y=async s=>{if(s.preventDefault(),!w||!p)return;const d={label:w,points:Number(R),icon:k,duration:B>0?Number(B):null,isAutoRepeat:j,isAutoApprove:L,isAutoPayout:z,assignedTo:p};try{S?(await $(N(x,"tasks_list",S),d),H(null)):await Q(T(x,"tasks_list"),d),c(""),v(10),o("üìù"),f(0),n(!1),P(!1),_(!1)}catch(A){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:",A),alert(m==="ru"?"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞—á—É":"Teht√§v√§n tallennus ep√§onnistui")}},Z=async()=>{if(!window.confirm(l.admin.clearConfirm))return;const s=h.filter(d=>(d.assignedTo===p||d.assignedTo==="all")&&!d.isAutoRepeat);try{await Promise.all(s.map(d=>F(N(x,"tasks_list",d.id))))}catch(d){console.error(d)}};return e.jsxs("div",{className:t.panelContainer,children:[g==="check"&&e.jsxs("div",{className:t.leftCol,children:[e.jsxs("div",{className:t.card,style:{background:"linear-gradient(135deg, var(--card-bg) 0%, var(--bg-color) 100%)"},children:[e.jsxs("div",{className:t.statsHeader,children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)",textTransform:"uppercase",fontWeight:"bold"},children:[l.admin.dailyLoad," "]}),e.jsxs("div",{style:{fontSize:"24px",fontWeight:"900"},children:[M," ",e.jsxs("span",{style:{fontSize:"16px",color:"var(--text-secondary)",fontWeight:"normal"},children:["/ ",W," pts"]})]})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs("div",{style:{fontSize:"20px",fontWeight:"900",color:"var(--accent-blue)"},children:[E,"%"]})})]}),e.jsx("div",{className:t.progressBar,children:e.jsx("div",{className:t.progressFill,style:{width:`${E}%`,backgroundColor:E===100?"var(--accent-green)":"var(--accent-blue)"}})})]}),e.jsxs("section",{style:{marginBottom:"30px"},children:[e.jsxs("h3",{style:{color:"var(--accent-orange)",fontSize:"18px",marginBottom:"15px"},children:["üîî ",l.admin.requests," (",q?.name||"...",") "]}),u.filter(s=>s.userId===p).length===0?e.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:"var(--text-secondary)",background:"rgba(255,255,255,0.02)",borderRadius:"24px",border:"1px dashed var(--border-color)"},children:["‚òï ",l.admin.noRequests," "]}):u.filter(s=>s.userId===p).map(s=>e.jsxs("div",{className:t.requestItem,children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[s.icon," ",s.label]}),e.jsx("div",{style:{color:s.points<0?"var(--accent-orange)":"var(--accent-green)",fontWeight:"bold"},children:s.points>0?`+${s.points}`:s.points})]}),e.jsx("button",{onClick:()=>J(s),style:{padding:"12px 20px",background:"var(--accent-green)",color:"white",border:"none",borderRadius:"15px",fontWeight:"bold"},children:"OK"})]},s.id))]})]}),g==="edit"&&e.jsxs("div",{className:t.leftCol,children:[e.jsx(Le,{t:l,currentChild:q,onSubmit:Y,editingId:S,onCancel:()=>H(null),formState:{newLabel:w,newPoints:R,newIcon:k,newDuration:B,autoRepeat:j,autoApprove:L,autoPayout:z},setters:{setNewLabel:c,setNewPoints:v,setNewIcon:o,setNewDuration:f,setAutoRepeat:n,setAutoApprove:P,setAutoPayout:_}}),e.jsxs("div",{style:{marginTop:"30px"},children:[e.jsxs("button",{onClick:Z,className:t.clearButton,style:{marginBottom:"20px",width:"100%"},children:["üóëÔ∏è ",l.admin.clearOld," "]}),e.jsxs("h4",{style:{color:"var(--text-secondary)",fontSize:"11px",textTransform:"uppercase",marginBottom:"15px"},children:["üìú ",l.admin.templates,": "]}),e.jsx(Pe,{t:l,tasks:h,users:b,selectedChildId:p,copyToForm:X})]})]}),g==="shop"&&e.jsx("div",{className:t.leftCol,children:e.jsx(We,{t:l})}),g==="levels"&&e.jsx("div",{className:t.leftCol,children:e.jsx($e,{t:l})})]})};export{Ge as AdminPanel};
