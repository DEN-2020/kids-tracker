import{j as s,r as u}from"./index-BPrzZQ1k.js";import{a as o,h as H,s as B}from"./Tasks.module-B6vfeooQ.js";const q="/kids-tracker/assets/coin-BsAl7R4M.mp3",W=({task:r,isWaiting:c,isHolding:a,deadlineText:h,waitingLabel:j,onStart:w,onStop:m})=>{const l=(i,x)=>{i.target.closest("button")||(x==="start"?c||w():m())};return s.jsxs("div",{className:`
        ${o.taskCard} 
        ${a?"shaking-intense":""} 
        ${c?o.taskWaiting:""}
      `,onMouseDown:i=>l(i,"start"),onMouseUp:i=>l(i,"stop"),onMouseLeave:i=>l(i,"stop"),onTouchStart:i=>l(i,"start"),onTouchEnd:i=>l(i,"stop"),style:{transform:a?"scale(0.95)":"scale(1)",touchAction:"manipulation",userSelect:"none",WebkitUserSelect:"none"},children:[s.jsx("div",{className:o.deadlineTag,children:c?"â³":`â±ï¸ ${h}`}),a&&!c&&s.jsx("svg",{className:"loading-ring",width:"100%",height:"100%",viewBox:"0 0 100 100",style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:s.jsx("circle",{cx:"50",cy:"50",r:"48",style:{fill:"none",stroke:"var(--accent-orange)",strokeWidth:4,strokeDasharray:"302",strokeDashoffset:"302",animation:"borderFill 5s linear forwards",strokeLinecap:"round"}})}),s.jsx("span",{className:o.taskIcon,style:{filter:c?"grayscale(1)":"none"},children:r.icon||"ðŸ“"}),s.jsx("div",{className:c?o.waitingText:o.taskLabel,children:r.label}),s.jsx("div",{className:c?o.waitingText:o.taskPoints,children:c?j:`+${r.points}`})]})},U=({t:r,availableTasks:c,myApprovals:a,runningTimer:h,formatTime:j,startTaskTimer:w,markAsDone:m,requestToStart:l,userRole:i})=>{const x=u.useRef({coin:new Audio(q),success:new Audio(B),hold:new Audio(H)}),[g,d]=u.useState(null),[$,D]=u.useState([]),[N,T]=u.useState(null),y=u.useRef(null),v=u.useRef(null),M=new Date().toLocaleDateString("sv-SE"),f=(e,t=.5)=>{const n=x.current[e];if(n)try{n.pause(),Object.assign(n,{currentTime:0,volume:t}),n.play().catch(()=>{})}catch{}},b=()=>{v.current&&(clearInterval(v.current),v.current=null);const e=x.current.hold;e&&(e.pause(),Object.assign(e,{currentTime:0}))},k=()=>{const e=Array.from({length:15}).map((t,n)=>({id:Date.now()+n,left:Math.random()*100+"vw"}));D(e),setTimeout(()=>D([]),1200)},P=async e=>{b(),T(null),d(e.id),requestAnimationFrame(async()=>{try{await l(e),k(),f("coin")}catch{console.error("Execute error")}finally{d(null)}})},R=e=>{if(!(a.some(n=>n.taskId===e.id)||e.isDone||e.isInWork||e.isPending||g===e.id||N===e.id)){if(i==="parent"){Promise.resolve().then(()=>{window.confirm(r.statsTitle==="Tilastot"?"Haluatko merkitÃ¤ tÃ¤mÃ¤n tehdyksi?":"Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð·Ð° Ñ€ÐµÐ±ÐµÐ½ÐºÐ°?")&&P(e)});return}b(),T(e.id),f("hold",.2),v.current=setInterval(()=>f("hold",.2),600),y.current=setTimeout(()=>P(e),5e3)}},F=()=>{y.current&&(clearTimeout(y.current),y.current=null),b(),T(null)},E=async(e,t)=>{if(e.stopPropagation(),g!==t){if(i==="parent"){Promise.resolve().then(async()=>{if(window.confirm(r.statsTitle==="Tilastot"?"HyvÃ¤ksytkÃ¶?":"ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚ÑŒ?")){d(t);try{await m(t),k(),f("success")}catch{console.error("Confirm error")}finally{d(null)}}});return}d(t);try{await m(t),k(),f("success")}catch{d(null)}}},I=c.map(e=>{const t=a.find(p=>p.taskId===e.id),n=e.lastCompleted===M||t?.status==="completed";return{...e,isDone:n,isInWork:t?.status==="in_progress",isPending:t?.status==="pending"}}),C=I.filter(e=>e.isDone).reduce((e,t)=>e+t.points,0),S=I.reduce((e,t)=>e+t.points,0),A=S>0?Math.round(C/S*100):0,L=(()=>{const e=new Date,t=new Date;t.setHours(21,0,0,0);const n=t.getTime()-e.getTime();return{text:n>0?`${Math.floor(n/36e5)}Ñ‡ ${Math.floor(n%36e5/6e4)}Ð¼`:"0Ñ‡ 0Ð¼"}})();return s.jsxs(s.Fragment,{children:[$.map(e=>s.jsx("div",{className:o.coin,style:{left:e.left},children:"ðŸ’°"},e.id)),s.jsxs("div",{className:o.statsCard,children:[s.jsxs("div",{className:o.statsInfo,children:[s.jsx("span",{style:{fontWeight:"800",fontSize:"14px"},children:r.statsTitle==="Tilastot"?"PÃ¤ivÃ¤n tavoite":"Ð¦ÐµÐ»ÑŒ Ð½Ð° Ð´ÐµÐ½ÑŒ"}),s.jsxs("span",{style:{fontWeight:"800",color:"var(--accent-blue)"},children:[C," / ",S," ðŸ†"]})]}),s.jsx("div",{className:o.progressTrack,children:s.jsx("div",{className:o.progressFill,style:{width:`${A}%`,backgroundColor:A===100?"var(--accent-green)":"var(--accent-blue)"}})})]}),s.jsx("h3",{style:{color:"var(--accent-green)",marginBottom:"15px"},children:r.inProgress}),s.jsx("div",{style:{display:"grid",gap:"15px",marginBottom:"30px"},children:a.filter(e=>e.status==="in_progress").map(e=>{const t=g===e.id,n=c.find(p=>p.id===e.taskId);return s.jsxs("div",{className:`${o.activeTaskCard} ${t?"task-approving":""}`,children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[s.jsx("span",{style:{fontWeight:"bold"},children:t?"ðŸš€...":e.label}),h?.id===e.id&&s.jsxs("span",{style:{color:"var(--accent-blue)",fontWeight:"bold"},children:["â±ï¸ ",j(h.timeLeft)]})]}),s.jsxs("div",{style:{display:"flex",gap:"10px"},children:[!t&&!h&&n?.duration&&s.jsx("button",{onClick:()=>w(e.id,n.duration),style:{padding:"10px",background:"var(--accent-blue)",color:"white",border:"none",borderRadius:"12px"},children:"â–¶ï¸"}),s.jsx("button",{onClick:p=>E(p,e.id),disabled:t,className:"payout-btn",style:{zIndex:999,position:"relative",cursor:"pointer"},children:t?"â³":r.done})]})]},e.id)})}),s.jsx("h3",{style:{color:"var(--accent-blue)",marginBottom:"15px"},children:r.availableTasks}),s.jsx("div",{className:o.tasksGrid,children:I.map(e=>{if(e.isDone||e.isInWork||g===e.id)return null;const t=e.isPending||a.some(n=>n.taskId===e.id);return s.jsx(W,{task:e,isWaiting:t,isHolding:N===e.id,deadlineText:L.text,waitingLabel:r.statsTitle==="Tilastot"?"Odottaa...":"Ð–Ð´ÐµÐ¼...",onStart:()=>R(e),onStop:F},e.id)})})]})};export{U as TaskList};
